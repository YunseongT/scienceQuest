<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³„ì ˆì˜ ë³€í™” íƒí—˜ ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            touch-action: manipulation;
        }
        .season-spring { background: linear-gradient(to bottom, #a8e063, #56ab2f); }
        .season-summer { background: linear-gradient(to bottom, #f8b500, #fceabb); }
        .season-autumn { background: linear-gradient(to bottom, #e67e22, #f39c12); }
        .season-winter { background: linear-gradient(to bottom, #00c6ff, #0072ff); }
        .season-experiment, .season-intro, .season-end { background: linear-gradient(to bottom, #d7d2cc, #304352); }
        .season-final { background: linear-gradient(to bottom, #8e44ad, #9b59b6); }
        .game-card, .form-card {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .option-btn {
            transition: all 0.3s ease;
        }
        .option-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .option-btn.correct {
            animation: correct-pulse 0.5s ease;
        }
        .option-btn.incorrect {
            animation: incorrect-shake 0.5s ease;
        }
        @keyframes correct-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); background-color: #2ecc71; color: white;}
            100% { transform: scale(1); }
        }
        @keyframes incorrect-shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="transition-colors duration-1000 bg-gray-200">

    <!-- í•™ìƒ ì •ë³´ ì…ë ¥ í™”ë©´ -->
    <div id="start-screen" class="min-h-screen w-full flex items-center justify-center p-4">
        <div class="form-card w-full max-w-md rounded-2xl p-8 shadow-lg text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">íƒí—˜ê°€ ì •ë³´ ì…ë ¥</h1>
            <p class="text-gray-600 mb-6">ê²°ê³¼ë¥¼ ì €ì¥í•˜ë ¤ë©´ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <form id="student-form">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <input type="number" id="grade" placeholder="í•™ë…„" class="p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    <input type="number" id="class" placeholder="ë°˜" class="p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <input type="number" id="number" placeholder="ë²ˆí˜¸" class="p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    <input type="text" id="name" placeholder="ì´ë¦„" class="p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-transform duration-200 hover:scale-105">
                    íƒí—˜ ì‹œì‘í•˜ê¸°
                </button>
            </form>
        </div>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="game-container" class="hidden min-h-screen w-full flex items-center justify-center p-4">
        <div id="game-card" class="game-card w-full max-w-2xl rounded-2xl p-6 md:p-10 shadow-lg text-center">
            
            <div id="character-icon" class="text-6xl mb-4">ğŸŒ</div>
            
            <h1 id="title" class="text-2xl md:text-3xl font-bold text-gray-800 mb-2"></h1>
            <p id="story" class="text-gray-600 mb-6 text-base md:text-lg"></p>
            <h2 id="question" class="text-xl md:text-2xl font-bold text-gray-800 mb-6"></h2>

            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

            <p id="feedback" class="mt-6 text-lg font-semibold h-8"></p>

            <button id="next-btn" class="hidden mt-8 bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-transform duration-200 hover:scale-105">
                ë‹¤ìŒìœ¼ë¡œ
            </button>
        </div>
    </div>

    <script type="module">
        const gameData = [
            {
                season: 'intro',
                icon: 'ğŸ§‘â€ğŸ”¬',
                title: 'ê³„ì ˆ íƒí—˜ëŒ€ì— ì˜¨ ê²ƒì„ í™˜ì˜í•´!',
                story: 'ë‚˜ëŠ” ê³„ì ˆì˜ ë¹„ë°€ì„ ì—°êµ¬í•˜ëŠ” íƒí—˜ê°€ë€ë‹¤. ë„ˆë„ ì˜¤ëŠ˜ë¶€í„° ë‚˜ì™€ í•¨ê»˜ ì§€êµ¬ì˜ ì•„ë¦„ë‹¤ìš´ ì‚¬ê³„ì ˆì„ íƒí—˜í•˜ë©° ê·¸ ì›ë¦¬ë¥¼ ë°í˜€ë³´ì§€ ì•Šì„ë˜?',
                question: 'íƒí—˜ì„ ì‹œì‘í•  ì¤€ë¹„ê°€ ë˜ì—ˆë‹ˆ?',
                options: [{ text: 'ë„¤, ì¤€ë¹„ëì–´ìš”!', answer: true }],
                feedbackCorrect: 'ì¢‹ì•„! ê·¸ëŸ¼ ë´„ë¶€í„° ì‹œì‘í•´ë³´ì!'
            },
            {
                season: 'spring',
                icon: 'ğŸŒ±',
                title: 'ë´„: ìƒëª…ì´ ê¹¨ì–´ë‚˜ëŠ” ê³„ì ˆ',
                story: 'ë”°ìŠ¤í•œ í–‡ì‚´ê³¼ í•¨ê»˜ ì–¼ì—ˆë˜ ë•…ì´ ë…¹ê³  ìƒˆì‹¹ì´ ë‹ì•„ë‚˜ê³  ìˆì–´. ë‚®ì˜ ê¸¸ì´ê°€ ì ì  ê¸¸ì–´ì§€ê³  ê¸°ì˜¨ë„ ì˜¬ë¼ê°€ê¸° ì‹œì‘í–ˆì–´.',
                question: 'ë´„ì— ë‚®ì˜ ê¸¸ì´ê°€ ê¸¸ì–´ì§€ê³  ë”°ëœ»í•´ì§€ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ?',
                options: [
                    { text: 'íƒœì–‘ì˜ ê³ ë„ê°€ ì ì  ë†’ì•„ì§€ê¸° ë•Œë¬¸ì—', answer: true },
                    { text: 'ì§€êµ¬ê°€ íƒœì–‘ê³¼ ê°€ê¹Œì›Œì§€ê¸° ë•Œë¬¸ì—', answer: false },
                    { text: 'ê²¨ìš¸ì  ìë˜ ë™ë¬¼ë“¤ì´ ê¹¨ì–´ë‚˜ì„œ', answer: false },
                    { text: 'ë‘êº¼ìš´ ì˜·ì„ ë²—ì–´ì„œ', answer: false },
                ],
                feedbackCorrect: 'ì •ë‹µì´ì•¼! íƒœì–‘ì˜ ê³ ë„ê°€ ë†’ì•„ì§€ë©´ ê°™ì€ ì–‘ì˜ í–‡ë¹›ì´ ë” ì¢ì€ ë©´ì ì„ ë¹„ì¶°ì„œ ê¸°ì˜¨ì´ ì˜¬ë¼ê°€.'
            },
            {
                season: 'summer',
                icon: 'â˜€ï¸',
                title: 'ì—¬ë¦„: ëœ¨ê±°ìš´ íƒœì–‘ì˜ ê³„ì ˆ',
                story: 'íƒœì–‘ì´ ê°€ì¥ ë†’ì´ ëœ¨ëŠ” ê³„ì ˆ, ì—¬ë¦„ì´ì•¼. ë‚®ì´ ì¼ë…„ ì¤‘ ê°€ì¥ ê¸¸ê³ , ì§™ì€ ë…¹ìŒê³¼ í•¨ê»˜ ë•€ì´ ì†¡ê³¨ì†¡ê³¨ ë§ºíˆëŠ”êµ¬ë‚˜.',
                question: 'ì—¬ë¦„ì² , íƒœì–‘ì˜ ë‚¨ì¤‘ ê³ ë„ê°€ ê°€ì¥ ë†’ì„ ë•Œ ê·¸ë¦¼ìì˜ ê¸¸ì´ëŠ” ì–´ë–»ê²Œ ë ê¹Œ?',
                options: [
                    { text: 'ê°€ì¥ ê¸¸ì–´ì§„ë‹¤', answer: false },
                    { text: 'ê°€ì¥ ì§§ì•„ì§„ë‹¤', answer: true },
                    { text: 'ì‚¬ë¼ì§„ë‹¤', answer: false },
                    { text: 'ê³„ì ˆê³¼ ìƒê´€ì—†ë‹¤', answer: false },
                ],
                feedbackCorrect: 'ë§ì•˜ì–´! íƒœì–‘ì´ ë¨¸ë¦¬ ê¼­ëŒ€ê¸° ê·¼ì²˜ì— ìˆì„ìˆ˜ë¡ ê·¸ë¦¼ìëŠ” ì§§ì•„ì§€ì§€.'
            },
            {
                season: 'autumn',
                icon: 'ğŸ‚',
                title: 'ê°€ì„: í’ìš”ë¡œìš´ ê²°ì‹¤ì˜ ê³„ì ˆ',
                story: 'í•˜ëŠ˜ì€ ë†’ê³  ê³µê¸°ëŠ” ì„ ì„ í•´ì¡Œì–´. ë‚˜ë¬´ë“¤ì€ ìš¸ê¸‹ë¶ˆê¸‹ ì˜·ì„ ê°ˆì•„ì…ê³ , ë™ë¬¼ë“¤ì€ ê²¨ìš¸ì„ ì¤€ë¹„í•˜ê¸° ì‹œì‘í–ˆì–´.',
                question: 'ê°€ì„ì´ ë˜ë©´ ë‚®ì˜ ê¸¸ì´ì™€ ê¸°ì˜¨ì€ ì–´ë–»ê²Œ ë³€í• ê¹Œ?',
                options: [
                    { text: 'ë‚®ì´ ê¸¸ì–´ì§€ê³  ê¸°ì˜¨ì´ ì˜¬ë¼ê°„ë‹¤', answer: false },
                    { text: 'ë‚®ì´ ì§§ì•„ì§€ê³  ê¸°ì˜¨ì´ ì˜¬ë¼ê°„ë‹¤', answer: false },
                    { text: 'ë‚®ì´ ì§§ì•„ì§€ê³  ê¸°ì˜¨ì´ ë‚´ë ¤ê°„ë‹¤', answer: true },
                    { text: 'ë‚®ì´ ê¸¸ì–´ì§€ê³  ê¸°ì˜¨ì´ ë‚´ë ¤ê°„ë‹¤', answer: false },
                ],
                feedbackCorrect: 'í›Œë¥­í•´! ê°€ì„ì€ íƒœì–‘ì˜ ê³ ë„ê°€ ì ì  ë‚®ì•„ì§€ë©´ì„œ ë‚®ì´ ì§§ì•„ì§€ê³  ê¸°ì˜¨ë„ ì„œëŠ˜í•´ì ¸.'
            },
            {
                season: 'winter',
                icon: 'â„ï¸',
                title: 'ê²¨ìš¸: í•˜ì–€ ëˆˆì˜ ê³„ì ˆ',
                story: 'ì°¬ ë°”ëŒì´ ë¶ˆê³  ì„¸ìƒì´ í•˜ì–—ê²Œ ë³€í–ˆì–´. ë‚®ì€ ì¼ë…„ ì¤‘ ê°€ì¥ ì§§ê³ , íƒœì–‘ì€ ë‚®ê²Œ ë– ì„œ ë”°ìŠ¤í•¨ì„ ëŠë¼ê¸° ì–´ë ¤ì›Œ.',
                question: 'ê²¨ìš¸ì´ ë‹¤ë¥¸ ê³„ì ˆë³´ë‹¤ ì¶”ìš´ ê·¼ë³¸ì ì¸ ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ?',
                options: [
                    { text: 'íƒœì–‘ì˜ ë‚¨ì¤‘ ê³ ë„ê°€ ë‚®ê³  ë‚®ì˜ ê¸¸ì´ê°€ ì§§ê¸° ë•Œë¬¸', answer: true },
                    { text: 'ì§€êµ¬ê°€ íƒœì–‘ì—ì„œ ê°€ì¥ ë©€ë¦¬ ë–¨ì–´ì ¸ ìˆê¸° ë•Œë¬¸', answer: false },
                    { text: 'ëˆˆì´ ë‚´ë ¤ì„œ ì„¸ìƒì„ ì°¨ê°‘ê²Œ ë§Œë“¤ê¸° ë•Œë¬¸', answer: false },
                    { text: 'ë‚œë°©ì„ í•˜ì§€ ì•Šì•„ì„œ', answer: false },
                ],
                feedbackCorrect: 'ì •í™•í•´! íƒœì–‘ì˜ ê³ ë„ê°€ ë‚®ì•„ í–‡ë¹›ì´ ë¹„ìŠ¤ë“¬íˆ ë¹„ì¶”ê³ , ë‚®ì˜ ê¸¸ì´ë„ ì§§ì•„ ì—´ì„ ì ê²Œ ë°›ê¸° ë•Œë¬¸ì´ì•¼.'
            },
            {
                season: 'experiment',
                icon: 'ğŸ“',
                title: 'ì‹¤í—˜ì˜ ì¡°ê±´ (ë³€ì¸ í†µì œ)',
                story: 'ì ê¹, ì‹¤í—˜ì„ ì‹œì‘í•˜ê¸° ì „ì— ì¤‘ìš”í•œ ì ì„ ë¨¼ì € ì•Œì•„ë³´ì! ì •í™•í•œ ê²°ê³¼ë¥¼ ì–»ìœ¼ë ¤ë©´, ìš°ë¦¬ê°€ ë°”ê¾¸ë ¤ëŠ” ì¡°ê±´(ì „ë“± ê°ë„) ì™¸ì— ë‹¤ë¥¸ ì¡°ê±´ë“¤ì€ ëª¨ë‘ ë˜‘ê°™ì´ ìœ ì§€í•´ì•¼ í•´. ì´ê²ƒì„ "ë³€ì¸ í†µì œ"ë¼ê³  ë¶€ë¥¸ë‹¨ë‹¤.',
                question: 'ìš°ë¦¬ê°€ í•  ì‹¤í—˜ì—ì„œ ë‹¤ë¥´ê²Œ í•´ì•¼ í•  ì¡°ê±´ì€ "ì „ë“±ì˜ ê°ë„"ì•¼. ê·¸ë ‡ë‹¤ë©´ ë°˜ë“œì‹œ ê°™ê²Œ ìœ ì§€í•´ì•¼ í•˜ëŠ” ì¡°ê±´ì€ ë¬´ì—‡ì¼ê¹Œ?',
                options: [
                    { text: 'ì†Œë¦¬ë°œìƒê¸°ì˜ ì†Œë¦¬ í¬ê¸°', answer: false },
                    { text: 'ì „ë“±ê³¼ íƒœì–‘ì „ì§€íŒ ì‚¬ì´ì˜ ê±°ë¦¬', answer: true },
                    { text: 'ì‹¤í—˜í•˜ëŠ” ì‹œê°„', answer: false },
                    { text: 'ì „ë“±ì˜ ê°ë„', answer: false },
                ],
                feedbackCorrect: 'ë§ì•„! ì „ë“±ì˜ ê°ë„ì— ë”°ë¥¸ íš¨ê³¼ë§Œ ì •í™•íˆ ë³´ë ¤ë©´, ì „ë“±ì˜ ë°ê¸°ë‚˜ ê±°ë¦¬ ê°™ì€ ë‹¤ë¥¸ ì¡°ê±´ë“¤ì€ ë³€í•˜ì§€ ì•Šë„ë¡ ë˜‘ê°™ì´ ë§ì¶°ì¤˜ì•¼ í•´. í›Œë¥­í•œ ê³¼í•™ìì¸ë°?'
            },
            {
                season: 'experiment',
                icon: 'ğŸ”¬',
                title: 'ì‹¤í—˜ ì‹œê°„: íƒœì–‘ ê³ ë„ì™€ ì—ë„ˆì§€',
                story: 'ì¢‹ì•„, ë³€ì¸ í†µì œì— ëŒ€í•´ ì˜ ë°°ì› ìœ¼ë‹ˆ ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì‹¤í—˜ì„ ì‹œì‘í•´ë³´ì. íƒœì–‘ì „ì§€íŒì— ì†Œë¦¬ë°œìƒê¸°ë¥¼ ì—°ê²°í–ˆì–´. íƒœì–‘ì „ì§€íŒì´ ë°›ëŠ” ì—ë„ˆì§€ê°€ í´ìˆ˜ë¡ ë” í° ì†Œë¦¬ê°€ ë‚  ê±°ì•¼.',
                question: 'ì „ë“±ì„ ìˆ˜ì§ìœ¼ë¡œ ë¹„ì¶œ ë•Œ(ì—¬ë¦„)ì™€ ë¹„ìŠ¤ë“¬íˆ ë¹„ì¶œ ë•Œ(ê²¨ìš¸) ì¤‘, ì–¸ì œ ì†Œë¦¬ë°œìƒê¸°ì˜ ì†Œë¦¬ê°€ ë” í´ê¹Œ?',
                options: [
                    { text: 'ë¹„ìŠ¤ë“¬íˆ ë¹„ì¶œ ë•Œ', answer: false },
                    { text: 'ìˆ˜ì§ìœ¼ë¡œ ë¹„ì¶œ ë•Œ', answer: true },
                    { text: 'ê°ë„ì™€ ìƒê´€ì—†ì´ ê°™ë‹¤', answer: false },
                    { text: 'ì†Œë¦¬ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤', answer: false },
                ],
                feedbackCorrect: 'ë”©ë™ëŒ•! íƒœì–‘ ê³ ë„ê°€ ë†’ì„ìˆ˜ë¡(ìˆ˜ì§) ê°™ì€ ë©´ì ì— ë” ë§ì€ íƒœì–‘ ì—ë„ˆì§€ê°€ ì§‘ì¤‘ë¼. ê·¸ë˜ì„œ íƒœì–‘ì „ì§€íŒì´ ê°•í•œ ì—ë„ˆì§€ë¥¼ ë°›ì•„ í° ì†Œë¦¬ë¥¼ ë‚´ëŠ” ê±°ì•¼!'
            },
            {
                season: 'final',
                icon: 'ğŸŒ',
                title: 'ìµœì¢… ì„ë¬´: ê³„ì ˆ ë³€í™”ì˜ í•µì‹¬ ì›ë¦¬',
                story: 'ë´„, ì—¬ë¦„, ê°€ì„, ê²¨ìš¸ì„ ëª¨ë‘ íƒí—˜í–ˆêµ¬ë‚˜! ë„Œ í›Œë¥­í•œ ê³„ì ˆ íƒí—˜ê°€ì•¼. ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ ëª¨ë“  ê³„ì ˆ ë³€í™”ê°€ ì¼ì–´ë‚˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ì´ìœ ë¥¼ ë§ì¶°ë´!',
                question: 'ì§€êµ¬ì— ê³„ì ˆ ë³€í™”ê°€ ë‚˜íƒ€ë‚˜ëŠ” ê°€ì¥ ê·¼ë³¸ì ì¸ ì›ì¸ì€ ë¬´ì—‡ì¼ê¹Œ?',
                options: [
                    { text: 'ì§€êµ¬ì˜ ìì „ ì†ë„ê°€ ë³€í•´ì„œ', answer: false },
                    { text: 'íƒœì–‘ê³¼ì˜ ê±°ë¦¬ê°€ ê°€ê¹Œì›Œì¡Œë‹¤ ë©€ì–´ì¡Œë‹¤ í•´ì„œ', answer: false },
                    { text: 'ì§€êµ¬ê°€ ìì „ì¶•ì´ ê¸°ìš¸ì–´ì§„ ì±„ íƒœì–‘ ì£¼ìœ„ë¥¼ ê³µì „í•˜ê¸° ë•Œë¬¸', answer: true },
                    { text: 'ë‹¬ì´ ì§€êµ¬ ì£¼ìœ„ë¥¼ ê³µì „í•˜ê¸° ë•Œë¬¸', answer: false },
                ],
                feedbackCorrect: 'ì™„ë²½í•´! ë°”ë¡œ ê·¸ê±°ì•¼! ì§€êµ¬ì˜ ê¸°ìš¸ì–´ì§„ ìì „ì¶•ì´ ê³„ì ˆ ë³€í™”ì˜ ëª¨ë“  ë¹„ë°€ì„ í‘¸ëŠ” ì—´ì‡ ì˜€ì–´!'
            },
            {
                season: 'end',
                icon: 'ğŸ†',
                title: 'íƒí—˜ ì™„ë£Œ! ê²°ê³¼ ì €ì¥ ì¤‘...',
                story: 'ì¶•í•˜í•´! ë„ˆëŠ” ì´ì œ ê³„ì ˆì˜ ë³€í™” ì›ë¦¬ë¥¼ ì™„ë²½í•˜ê²Œ ì´í•´í•˜ëŠ” ìµœê³ ì˜ ê³„ì ˆ íƒí—˜ê°€ê°€ ë˜ì—ˆì–´. ê²°ê³¼ê°€ ê³§ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë  ê±°ì•¼!',
                question: 'ë‹¤ì‹œ íƒí—˜ì„ ì‹œì‘í• ê¹Œ?',
                options: [{ text: 'ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ê¸°', answer: true }],
                feedbackCorrect: 'ì¢‹ì•„! ìƒˆë¡œìš´ íƒí—˜ì„ ì‹œì‘í•˜ì!'
            }
        ];

        let currentStage = 0;
        let studentInfo = {};
        let score = 0;
        const totalProblems = gameData.filter(stage => stage.options.length > 1).length;

        const startScreen = document.getElementById('start-screen');
        const studentForm = document.getElementById('student-form');
        const gameContainer = document.getElementById('game-container');
        const iconEl = document.getElementById('character-icon');
        const titleEl = document.getElementById('title');
        const storyEl = document.getElementById('story');
        const questionEl = document.getElementById('question');
        const optionsContainer = document.getElementById('options-container');
        const feedbackEl = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');

        studentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            studentInfo = {
                grade: document.getElementById('grade').value,
                classNum: document.getElementById('class').value,
                stdNumber: document.getElementById('number').value,
                name: document.getElementById('name').value,
            };
            startScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            loadStage(currentStage);
        });

        async function saveResultToSheet() {
            // --- 3ë‹¨ê³„: ì—¬ê¸°ì— 2ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ ì›¹ ì•± URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”! ---
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyHHERaOcjnwfYOm8oFqHbY4EVqaZmKpvyIquT4raRvonGx3vgY0LZ6UzrfkSpMGhPXhg/exec';

            if (SCRIPT_URL === 'ì—¬ê¸°ì—_ë°°í¬ëœ_ìŠ¤í¬ë¦½íŠ¸_URLì„_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”') {
                titleEl.textContent = 'íƒí—˜ ì™„ë£Œ! (ì €ì¥ ì„¤ì • í•„ìš”)';
                storyEl.textContent = 'ê²°ê³¼ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ êµ¬ê¸€ ì•± ìŠ¤í¬ë¦½íŠ¸ URL ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.';
                return;
            }

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({
                        ...studentInfo,
                        score: score,
                        totalProblems: totalProblems
                    })
                });
                
                console.log("ê²°ê³¼ ì „ì†¡ ì‹œë„ ì™„ë£Œ.");
                titleEl.textContent = 'íƒí—˜ ì™„ë£Œ! ê²°ê³¼ ì €ì¥ ì„±ê³µ!';
                storyEl.textContent = 'ì¶•í•˜í•´! ë„ˆëŠ” ì´ì œ ê³„ì ˆì˜ ë³€í™” ì›ë¦¬ë¥¼ ì™„ë²½í•˜ê²Œ ì´í•´í•˜ëŠ” ìµœê³ ì˜ ê³„ì ˆ íƒí—˜ê°€ê°€ ë˜ì—ˆì–´. ê²°ê³¼ê°€ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆì„ ê±°ì•¼!';

            } catch (error) {
                console.error("ê²°ê³¼ ì €ì¥ ì¤‘ ì—ëŸ¬ ë°œìƒ: ", error);
                titleEl.textContent = 'íƒí—˜ ì™„ë£Œ! (ì €ì¥ ì‹¤íŒ¨)';
                storyEl.textContent = 'ê²°ê³¼ë¥¼ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì €ì¥í•˜ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.';
            }
        }

        function loadStage(stageIndex) {
            const stage = gameData[stageIndex];
            
            if (stage.season === 'end') {
                saveResultToSheet(); // Firebase í•¨ìˆ˜ ëŒ€ì‹  êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ
            }

            gameContainer.className = `min-h-screen w-full flex items-center justify-center p-4 transition-colors duration-1000 season-${stage.season}`;
            
            iconEl.textContent = stage.icon;
            titleEl.textContent = stage.title;
            storyEl.textContent = stage.story;
            questionEl.textContent = stage.question;

            optionsContainer.innerHTML = '';
            feedbackEl.textContent = '';
            feedbackEl.classList.remove('text-green-600', 'text-red-600');
            nextBtn.classList.add('hidden');

            stage.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.classList.add('option-btn', 'w-full', 'bg-white', 'text-gray-700', 'font-semibold', 'py-3', 'px-4', 'rounded-lg', 'shadow-md', 'border', 'border-gray-200');
                button.onclick = () => handleOptionClick(option.answer, button);
                optionsContainer.appendChild(button);
            });
        }

        function handleOptionClick(isCorrect, button) {
            Array.from(optionsContainer.children).forEach(btn => btn.disabled = true);
            const stage = gameData[currentStage];

            if (isCorrect) {
                if (stage.options.length > 1) { 
                    score++;
                }
                feedbackEl.textContent = stage.feedbackCorrect;
                feedbackEl.classList.add('text-green-600');
                button.classList.add('correct');
                
                nextBtn.classList.remove('hidden');
            } else {
                feedbackEl.textContent = 'ìŒ.. ë‹¤ì‹œ í•œë²ˆ ìƒê°í•´ë³¼ê¹Œ?';
                feedbackEl.classList.add('text-red-600');
                button.classList.add('incorrect');
                setTimeout(() => {
                    Array.from(optionsContainer.children).forEach(btn => btn.disabled = false);
                    button.classList.remove('incorrect');
                    feedbackEl.textContent = '';
                }, 1000);
            }
        }
        
        nextBtn.addEventListener('click', () => {
             if (gameData[currentStage].season === 'end') {
                currentStage = 0;
                score = 0;
                startScreen.classList.remove('hidden');
                gameContainer.classList.add('hidden');
                studentForm.reset();
            } else {
                currentStage++;
                loadStage(currentStage);
            }
        });

    </script>
</body>
</html>



